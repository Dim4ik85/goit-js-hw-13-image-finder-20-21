{"version":3,"sources":["webpack:///./js/Api/apiService.js","webpack:///./index.js","webpack:///./templates/imageList.hbs"],"names":["apiService","this","searchQuery","page","renderedImg","fetchHits","url","BASE_URL","fetch","then","response","json","data","incrementPage","resetPage","newQuery","debounce","require","hitsApiService","HitsApiService","refs","searchForm","document","querySelector","galleryList","input","sentinel","galleryRequests","console","log","hits","totalHits","observer","observe","insertAdjacentHTML","imageListTpl","addHitsMarkup","unobserve","clearHitsContainer","innerHTML","addEventListener","e","preventDefault","query","target","value","trim","length","IntersectionObserver","entries","forEach","entry","isIntersecting","options","rootMargin","event","nodeName","changeModalImage","dataset","source","basicLightbox","show","Handlebars","module","exports","template","container","depth0","helpers","partials","alias1","lambda","alias2","escapeExpression","lookupProperty","parent","propertyName","Object","prototype","hasOwnProperty","call","stack1","nullContext","program","noop"],"mappings":"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","file":"main.cdf1c547639dd15ae0f5.js","sourcesContent":["const BASE_URL = 'https://pixabay.com/api/';\nconst API_KEY = '19367705-6c391461160466e2850694aab';\n\nexport default class apiService {\n    constructor() {\n        this.searchQuery = '';\n        this.page = 1;\n        this.renderedImg = 0;\n    }\n\n    fetchHits() {\n        const url = `${BASE_URL}?key=${API_KEY}&q=${this.searchQuery}&image_type=photo&per_page=12&page=${this.page}`;\n\n        return fetch(url)\n            .then(response => response.json())\n            .then((data) => {\n                this.incrementPage();\n\n                return data;\n            });\n    }\n\n    incrementPage() {\n        this.page += 1;\n    }\n\n    resetPage() {\n        this.page = 1;\n        this.renderedImg = 0;\n    }\n\n    // Если убрать get и set, тогда везьде обращаемся только к searchQuery, a не query \n    get query() {\n        return this.searchQuery;\n    }\n\n    set query(newQuery) {\n        this.searchQuery = newQuery;\n    }\n}","import './css/styles.css';\nimport imageListTpl from './templates/imageList.hbs';\nimport HitsApiService from './js/Api/apiService';\n\nimport * as basicLightbox from 'basiclightbox';\nimport 'basiclightbox/dist/basicLightbox.min.css';\n\nvar debounce = require('lodash.debounce');\nconst hitsApiService = new HitsApiService();\n\nconst refs = {\n    searchForm: document.querySelector('.search-form'),\n    galleryList: document.querySelector('.gallery'),\n    input: document.querySelector('.search-input'),\n    sentinel: document.querySelector('#sentinel'),\n};\n\nrefs.input.addEventListener('input', debounce(onSearch, 500));\n\nfunction onSearch(e) {\n    e.preventDefault();\n\n    hitsApiService.query = e.target.value.trim();\n    if(hitsApiService.query.length === 0) {\n        \n        return clearHitsContainer();\n    } \n\n    hitsApiService.resetPage();\n    clearHitsContainer();\n    onLoadMore(); \n}\n\nfunction onLoadMore() {\n   hitsApiService.fetchHits().then(galleryRequests);\n}\n\nfunction galleryRequests(data) {\n    console.log(data.hits);\n           \n        if(hitsApiService.renderedImg < data.totalHits) {\n            observer.observe(refs.sentinel);\n            addHitsMarkup(data.hits);\n            hitsApiService.renderedImg += 12;\n        }\n\n        if(hitsApiService.renderedImg === data.totalHits) {\n            observer.unobserve(refs.sentinel);\n            return;\n        }\n\n        if(hitsApiService.renderedImg + 12 > data.totalHits) {\n            observer.unobserve(refs.sentinel);\n        }\n    }\n\nfunction addHitsMarkup(data) {\n    refs.galleryList.insertAdjacentHTML('beforeend', imageListTpl(data));\n}\n\nfunction clearHitsContainer() {\n refs.galleryList.innerHTML = '';    \n}\n\nconst observer = new IntersectionObserver(onEntry, options);\n\n\n    function onEntry (entries) {\n        entries.forEach(entry => {\n            if (entry.isIntersecting && hitsApiService.query !== '') {\n                console.log(\"LOADING...\");\n                hitsApiService.fetchHits().then(galleryRequests);\n            }\n        });\n    }\n    const options = {\n        rootMargin: '100px'\n    }   \n\n//модалка basicLightbox\nrefs.galleryList.addEventListener('click', onGalleryElClick);    \n\nfunction onGalleryElClick(event) {\n        if (event.target.nodeName !== 'IMG') {\n          return;\n        }\n        \n        const changeModalImage = `<img src=${event.target.dataset.source} alt=\"icon\" />`;\n        const instance = basicLightbox.create(changeModalImage);\n        instance.show();\n }","var Handlebars = require(\"../../node_modules/handlebars/runtime.js\");\nfunction __default(obj) { return obj && (obj.__esModule ? obj[\"default\"] : obj); }\nmodule.exports = (Handlebars[\"default\"] || Handlebars).template({\"1\":function(container,depth0,helpers,partials,data) {\n    var alias1=container.lambda, alias2=container.escapeExpression, lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    };\n\n  return \"<div class=\\\"photo-card\\\">\\n<img src=\\\"\"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"webformatURL\") : depth0), depth0))\n    + \"\\\" data-source=\"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"largeImageURL\") : depth0), depth0))\n    + \" alt=\\\"\"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"tags\") : depth0), depth0))\n    + \"\\\" width=\\\"400\\\" />\\n\\n  <div class=\\\"stats\\\">\\n    <p class=\\\"stats-item\\\">\\n      <i class=\\\"material-icons\\\">thumb_up</i>\\n      \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"likes\") : depth0), depth0))\n    + \"\\n    </p>\\n    <p class=\\\"stats-item\\\">\\n      <i class=\\\"material-icons\\\">visibility</i>\\n      \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"views\") : depth0), depth0))\n    + \"\\n    </p>\\n    <p class=\\\"stats-item\\\">\\n      <i class=\\\"material-icons\\\">comment</i>\\n      \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"comments\") : depth0), depth0))\n    + \"\\n    </p>\\n    <p class=\\\"stats-item\\\">\\n      <i class=\\\"material-icons\\\">cloud_download</i>\\n      \"\n    + alias2(alias1((depth0 != null ? lookupProperty(depth0,\"downloads\") : depth0), depth0))\n    + \"\\n    </p>\\n  </div>\\n</div>\\n\";\n},\"compiler\":[8,\">= 4.3.0\"],\"main\":function(container,depth0,helpers,partials,data) {\n    var stack1, lookupProperty = container.lookupProperty || function(parent, propertyName) {\n        if (Object.prototype.hasOwnProperty.call(parent, propertyName)) {\n          return parent[propertyName];\n        }\n        return undefined\n    };\n\n  return ((stack1 = lookupProperty(helpers,\"each\").call(depth0 != null ? depth0 : (container.nullContext || {}),depth0,{\"name\":\"each\",\"hash\":{},\"fn\":container.program(1, data, 0),\"inverse\":container.noop,\"data\":data,\"loc\":{\"start\":{\"line\":1,\"column\":0},\"end\":{\"line\":24,\"column\":9}}})) != null ? stack1 : \"\");\n},\"useData\":true});"],"sourceRoot":""}